
Создание темы
==============

В штатной поставке ExtJS сразу доступны несколько готовых тем дизайна.
Тем не менее, вы можете создать свою собственную тему, чтобы соответствовать 
вашему вкусу дизайна или корпоративному стилю.

Темы могут совместно использоваться любым количеством приложений ExtJS.
Темы позволяют вам стилизовать один раз и применять этот стиль снова 
и снова с уверенностью в согласованности внешнего вида ваших приложений.

Данное руководство рассказывает как создать свою тему для Classic Toolkit.
Для Modern Toolkit будет отдельная статья.

- [Создание темы](#Создание-темы)
	- [Создание пользовательской темы](#Создание-пользовательской-темы)
		- [Подготовка рабочего пространства](#Подготовка-рабочего-пространства)
		- [Создание темы (пакета типа тема)](#Создание-темы-пакета-типа-тема)
		- [Наследование темы](#Наследование-темы)
			- [Modern Toolkit](#Modern-Toolkit)
			- [Classic Toolkit](#Classic-Toolkit)
			- [Какую тему следует расширить для вашей пользовательской темы?](#Какую-тему-следует-расширить-для-вашей-пользовательской-темы)
		- [Сборка темы](#Сборка-темы)
	- [Создание тестового приложения](#Создание-тестового-приложения)
		- [Изменение темы приложения](#Изменение-темы-приложения)
		- [Запуск приложения в режиме watch](#Запуск-приложения-в-режиме-watch)
	- [АПИ тем](#АПИ-тем)
		- [Настройка глобальных переменных темы](#Настройка-глобальных-переменных-темы)
		- [Патчи темы (Overrides)](#Патчи-темы-Overrides)
		- [Изменение изображений базовой темы](#Изменение-изображений-базовой-темы)
		- [Добавление пользовательских функций и примесей](#Добавление-пользовательских-функций-и-примесей)
	- [Стилизация вашего приложения](#Стилизация-вашего-приложения)
		- [Стилизация представлений вашего приложения](#Стилизация-представлений-вашего-приложения)
		- [Изменение переменных темы в вашем приложении](#Изменение-переменных-темы-в-вашем-приложении)
	- [Изменение дизайна компонент](#Изменение-дизайна-компонент)
		- [Изменение переменных темы для компонент](#Изменение-переменных-темы-для-компонент)
		- [Использование примесей для компонент](#Использование-примесей-для-компонент)
		- [Изменение изображений компонент](#Изменение-изображений-компонент)
	- [Дополнительные замечания](#Дополнительные-замечания)
		- [Изображения компонента из ui === default](#Изображения-компонента-из-ui-default)
	- [Ссылки](#Ссылки)

Создание пользовательской темы
------------------------------

Тема это просто особый тип пакета Sencha Cmd. 
Все пакеты могут содержать JavaScript, стили CSS и ресурсы, которые будут 
включены в приложения, когда Sencha Cmd их собирает. Темы в штатной поставке 
ExtJS используют все эти типы активов.

### Подготовка рабочего пространства

Рабочее пространство это специальным образом подготовленная директория,
где размещаются: ExtJS-приложения, пакеты, темы.

Как подготовить рабочее пространство и тестовое приложение читайте
в одной из статей: [Шпаргалка по Sencha Cmd][cmd], [Быстрый старт][quick-start]

### Создание темы (пакета типа тема)

Sencha Cmd упрощает процесс создания пользовательской темы путем создания 
пакета темы, содержащего все необходимые файлы. Выполните следующую команду 
из директории рабочего пространства, чтобы создать свою тему:

```bash
sencha generate theme my-theme
```

После выполнения команды в директории `packages/local/my-theme` будет создан пакет 
с пустой темой со следущим содержимым:


Файл/директория | Описание
-|-
package.json | Файл с настройками пакета.  
resources | Директория с изображениями и другими статическими ресурсами.
overrides | Патчи на классы компонентов.
sass | Эта директория содержит все исходные файлы вашей темы и содержит на 4 основных раздела:
sass/var/ | Определения переменных для компонент.
sass/var/all.scss | Глобальные переменные.
sass/src/ | Правила и миксины (с использованием переменных, определенных в sass/var).
sass/etc/ | Дополнительные функции или миксины.
sass/example | Используется Sencha Cmd для выполнения разрезания изображения для IE8/9 (директорию нельзя не удалять, используется только Classic Toolkit).

> Файлы и папки в sass/src и overrides должны быть организованы в соответствии с именем класса компонента, для которого вы определяете тот или иной стилистический файл. Например, если вы хотите создать новый стиль для компонента с именем класса Ext.panel.Panel, то стиль должен быть помещен в файл с именем sass/src/panel/Panel.scss (здесь Ext поменяли на sass/src, далее разместили в директорию panel и файл назван по имени класса Panel.scss). Важно размещать вызовы примесей (mixin) и правила стиля в соответствующем файле на основе имени связанного класса, чтобы Sencha Cmd мог включать только тот код, необходим приложению при сборке.

> На таком же принципе можно создавать файлы в директории sass/var/. Вы можете просто использовать файл sass/var/all.scss, если у вас небольшое количество переменных для настройки. Поскольку переменные не влияют на размер создаваемого при сборке CSS, выбор между сохранением всех переменных темы в одном файле или разбиением на несколько файлов, организованных по имени класса, зависит от личных предпочтений или руководящих принципов проекта.


### Наследование темы


Все штатные темы Sencha образуют иерархию тем. Каждый пакет темы расширяет родительскую или базовую тему. Следующим шагом в создании вашей пользовательской темы является выбор темы для расширения. ExtJS поставляется с несколькими темами для каждого инструментария (Toolkit):

#### Modern Toolkit

Тема | Описание
-|-
theme-material | Тема материального дизайна.
theme-ios | Тема iOS.
theme-triton | Современная плоская, безграничная тема.
theme-neptune | Современная безграничная тема.


#### Classic Toolkit

Тема | Описание
-|-
theme-triton | Современная тема с использованием шрифтов. Расширяет тему «нептун».
theme-crisp | Минималистическая тема. Расширяет тему «нептун».
theme-crisp-touch | Четкая сенсорная тема. Расширяет «тему-четкость».
theme-neptune | Современная безграничная тема.
theme-neptune-touch | Непринужденная сенсорная тема. Расширяет тему «нептун».
theme-classic | Классическая синяя тема Ext JS.
theme-gray | Серые темы. Расширяет «тематику-классику».

![][theme-chart]

#### Какую тему следует расширить для вашей пользовательской темы? 

Для Modern Toolkit, мы рекомендуем использовать theme-material или theme-triton, в то время как для Classic Toolkit, мы рекомендуем использовать theme-triton, theme-crisp или в theme-neptune качестве отправной точки для пользовательских тем.

В theme-base и (в Classic Toolkit) theme-neutral темы должны рассматриваться как абстрактные и не стоит расширяться непосредственно от них.

В этом уроке мы создадим пользовательскую тему, которая расширяется theme-triton. Первым шагом является настройка вашей пользовательской темы так, чтобы она ее расширяла. Это делается путем изменения extend свойства файла packages/local/my-theme/package.json:

```json
"extend": "theme-triton"
```

Ваша пользовательская тема теперь настроена на использование темы Triton в качестве базовой. Ваша пользовательская тема сейчас идентична теме Triton. На следующих шагах вы внесете свои изменения, чтобы создать свою тему, отличную от Triton.

### Сборка темы


Сборка темы создает build каталог в директории вашего тематического пакета. Внутри my-theme/build/resources вы найдете файл с именем my-theme-all.css. Этот файл содержит все правила стиля для всех компонентов ExtJS для вашей темы. Файлы встроенной темы содержат все стили для каждого компонента ExtJS и полезны для приложений, которые не используют Sencha Cmd.

> Примечание. Нет необходимости собирать тему, когда эта тема используется в приложении Sencha Cmd. Когда Sencha Cmd создает приложение, он включает файлы .js и .scss файлы, необходимые непосредственно из исходных файлов темы.
	
	
Создание тестового приложения
-----------------------------

Если вы при подготовке рабочего пространства (см. начало этой статьи) воспользовались одной из предложенных там статей, то у вас помимо самого рабочего пространства в директории создано тестовое приложение.

### Изменение темы приложения

Для того, чтобы изменить тему приложения достаточно изменить параметр theme в файле myapp/path/app.json:

```json
"theme": "my-theme"
```

### Запуск приложения в режиме watch

Для запуска приложения в режиме watch выполните следующую команду:

```bash
sencha app watch --fashion
```

Опция `--fashion` позволяет менять стили без перезагрузки браузера.

После запуска sencha app watch вы можете загрузить свое приложение в браузере, используя URL-адрес:

http://localhost:1841/myapp/path/



АПИ тем
-------

ExtJS предоставляет АПИ тем в виде: набора переменных и миксинов. Переменные нужны, чтобы изменить
вид любого компонента просто путем изменения соответствующей переменной. А миксины нужны, чтобы 
создать именнованный набор (ui) таких измененных переменных. Позже этот набор можно применить 
к любому компоненту просто указав имя набора в свойстве ui (из config) компонента.
Такие миксины называются UI-миксины.

Полный список глобальных переменных смотрите в [Global_CSS][global-css].
Также у каждого компонента есть свой список переменных (см. раздел theme variables в оф. справке).

### Настройка глобальных переменных темы

Начнем изменения c того, что поменяем базовый цвет приложения при помощи переменной $base-color, на основе которого вычисляются многие цвета компонентов ExtJS. Внимание, изменение $base-color в теме вызовает глобальное изменение $base-color, которое будет влиять на большинство компонентов библиотеки ExtJS.

Создайте файл packages/local/my-theme/sass/src/Component.scss и добавьте следующий код:

```scss
$base-color: #317040;
```

Значение $base-color должно быть допустимым кодом цвета HTML,
см. веб-страницу [HTML Color Codes](https://html-color-codes.info/).

После этого вы должны увидеть зеленый цвет, который мы указали ранее в $base-color применительно к компонентам отображающимся на экране.

Примечание. Все переменные темы определены как динамические, поэтому декларация dynamic() не требуется для их установки (как показано выше). Однако, если вы хотите определить свои собственные переменные, мы рекомендуем сделать их динамическими:

```scss
$my-custom-color: dynamic(red);
```

Подробнее о динамических переменных читайте в статье [Fashion][fashion].



### Патчи темы (Overrides)

Иногда тема должна изменить какой-либо аспект компонента, который настраивается только с помощью JavaScript. Это легко осуществить, добавив переопределение (патч, override) JavaScript в ваш пакет. Чтобы продемонстрировать, как это сделать, давайте изменим конфигурацию заголовков titleAlign в пользовательской теме. Создайте новый файл с именем my-theme/overrides/panel/Panel.js и добавьте следующий код:

```javascript
Ext.define('MyTheme.panel.Panel', {
    override: 'Ext.panel.Panel',
    titleAlign: 'center'
});
```

Когда вы будете просматривать приложение в браузере, вы увидете, что все заголовки панелей имеют заголовки, которые выравнены по центру. 

> Примечание. Не смотря на то, что таким образом может быть переопределена любая конфигурация (любое свойство) компонента ExtJS, лучше всего использовать переопределения (патчи, override) для изменения тех свойств, которые влияют на внешний вид (а не на функциональность) компонента, потому что мы делаем тему дизайна, а не пакет, меняющий функциональность приложения.

### Изменение изображений базовой темы

Все необходимые объекты изображения по умолчанию наследуются от родительской темы, но в некоторых случаях вам может потребоваться переопределить изображение. Это можно легко сделать, поместив нужное изображение my-theme/resources/images/ и присвоив ему то же имя, что и изображение, предназначенное для переопределения базовой темы.

Во многих современных темах, например, theme-triton есть несколько изображений. В этих темах используются значки векторных шрифтов. Поэтому изображения, которые вы можете вытеснить таким образом, зависят от вашего выбора базовой темы.

### Добавление пользовательских функций и примесей

Если для вашей темы требуются функции или примеси (mixins), которые не связаны со стилем компонента (например, утилиты), их следует поместить в my-theme/sass/etc директории вашей темы.

Вы можете организовать файлы в этом каталоге, как вам нравится, но единственный файл, 
который Sencha Cmd включает в сборку это `my-theme/sass/etc/all.scss`. Любые другие файлы 
должны быть импортированы (при помощи `@import`) в файл `all.scss`. Для примера, который 
следует этому правилу, см. `ext/classic/theme-base/sass/etc/` (тут под `ext/` имеется 
ввиду путь к SDK, например `node_modules/infogorod-sencha-extjs-6.5.3.57/`).



Стилизация вашего приложения
----------------------------

Выше был описан процесс создания темы. То есть дизайн, который может быть использован сразу несколькими
приложениями одновременно. Но есть возможность менять дизайн у конкретного одного приложения (то есть 
без создания темы и без наследования). Sencha Cmd обеспечивает простой способ добавления стиля на уровне 
приложения, позволяя вам упорядочить свои стили прямо рядом с вашим кодом JavaScript.

### Стилизация представлений вашего приложения

Чтобы написать правила CSS, связанные с представлением приложения, вы создаете .scss файл в той же папке и с тем же базовым именем, что и представление. Например, чтобы создать стиль представления App.view.main.Main, вы можете добавить Main.scss в эту папку:

```
demo-app/
   app/
      view/
         main/
            Main.js
            Main.scss
            MainController.js
            MainModel.js
```

Хотя возможность добавлять произвольные стили CSS обеспечивает максимальную гибкость, лучше избегать непосредственного изменения стиля элементов, принадлежащих компонентам из штатной поставки ExtJS. Вместо этого они должны быть разработаны с использованием АПИ тем, когда это возможно. Использование АПИ тем гарантирует совместимость вашего стиля с новыми версиях ExtJS.



### Изменение переменных темы в вашем приложении

Приложение выступает в качестве конечного уровня в иерархии тем. Таким образом, приложения могут изменять переменные темы.

Давайте переопределим переменную $base-color в приложении. Создайте Application.scss файл:

```
demo-app/
   app/
      Application.js
      Application.scss
```

Этот Application.scss файл является простым вариантом хранения глобальных настроек, поскольку он соответствует глобальному характеру Application класса. И добавьте в этот файл следующее:

```scss
$base-color: #724289;
```

Просмотрите приложение в браузере, и вы увидите, что базовый цвет изменился на фиолетовый.


Изменение дизайна компонент
---------------------------

### Изменение переменных темы для компонент

Каждый штатный компонент ExtJS имеет список переменных, которые можно использовать для настройки его внешнего вида. Давайте изменим font-family заголовок панели my-theme. Создайте файл с именем my-theme/sass/var/panel/Panel.scss и добавьте следующий код:

```scss
$panel-header-font-family: Times New Roman;
```

Просмотрите ваше приложение сейчас и вы увидите, что в заголовках панелей используется шрифт Times New Roman. Полный список переменных для каждого компонента можно найти в разделе «Theme Variables» документации API компонента. Например, см. [Ext.panel.Panel][panel] и прокрутите до раздела под названием «Theme Variables».


### Использование примесей для компонент


Все компоненты в Ext JS Classic Toolkit имеют ui свойство config, равное по умолчанию "default". Это свойство конфигурации можно настроить на отдельных экземплярах компонентов, чтобы придать им другой вид из других экземпляров того же типа. Эта конфигурация используется в теме Neptune для создания различных типов панелей и кнопок. Например, панели с по умолчанию ui имеют темно-синие заголовки и панели с «светом» ui имеют светло-голубые заголовки. Кнопки используются ui, чтобы кнопки кнопок на панели выглядели иначе, чем обычные кнопки.

Тема theme-neutral включает в себя тематический Mixins (или UI Mixins) для многих из различных компонентов Ext JS. Вы можете вызвать эти миксины для создания нового ui для компонентов. Доступные миксины для каждого компонента перечислены в документации API. Например, см. [Ext.panel.Panel][panel] и прокрутите вниз до раздела «Theme Mixins», чтобы узнать, какие параметры принимает пользовательский интерфейс панели. Давайте используем этот mixin для создания настраиваемой панели ui.

Создайте файл с именем my-theme/sass/src/panel/Panel.scss и добавьте к нему следующее:


```scss
@include extjs-panel-ui(
    $ui: 'highlight-framed',
    $ui-header-background-color: red,
    $ui-border-color: red,
    $ui-header-border-color: red,
    $ui-body-border-color: red,
    $ui-border-width: 5px,
    $ui-border-radius: 5px,
    $ui-header-color: white
);
```

Этот вызов mixin создает новую панель с ui именем "highlight" которая имеет красный заголовок, красную границу, границу 5 пикселей, радиус границы 5 пикселей и белый текст. Чтобы использовать это ui, настройте Panel с 'highlight' его ui собственностью (вместе с frame: true). Откройте demo-app/app/view/main/List.js и замените его содержимое следующим текстом:

```javascript
Ext.define('App.view.main.List', {
    extend: 'Ext.grid.Panel',
    xtype: 'mainlist',

    ui: 'highlight',
    frame: true,

    requires: [
        'App.store.Personnel'
    ],

    title: 'Personnel',

    store: {
        type: 'personnel'
    },

    columns: [
        { text: 'Name',  dataIndex: 'name' },
        { text: 'Email', dataIndex: 'email', flex: 1 },
        { text: 'Phone', dataIndex: 'phone', flex: 1 }
    ],

    listeners: {
        select: 'onItemSelected'
    }
});
```

Просмотрите свое приложение в веб-браузере, и вы увидите красную «подсветку» таблицы.

> В то время как UI mixins - удобный способ настроить несколько явлений для компонента, их не следует злоупотреблять. Каждый вызов интерфейса UI создает дополнительные правила CSS. Чрезмерные вызовы для UI mixins могут привести к чрезмерно большому CSS-файлу.

### Изменение изображений компонент

В качестве примера изменения ресурса изображения изменим значок информации компонента MessageBox. Сохраните следующее изображение my-theme/resources/images/shared/icon-info.png. Этот объект изображения будет иметь приоритет над тем, который используется в родительской теме Crisp at my-workspace/ext/classic/theme-crisp/resources/images/shared/icon-info.png.

Теперь измените тестовое приложение, чтобы показать MessageBox, который использует пользовательский значок. Добавьте следующую tbar конфигурацию в «highlight» Grid в demo-app/app/view/main/List.js файле приложения:


```javascript
tbar: [{
    text: 'Show Message',
    handler: function() {
        Ext.Msg.show({
            title: 'Info',
            msg: 'Message Box with custom icon',
            buttons: Ext.MessageBox.OK,
            icon: Ext.MessageBox.INFO
        });
    }
}]
```

Теперь просмотрите приложение в браузере. Когда вы нажимаете кнопку «Показать сообщение», вы должны увидеть, что MessageBox содержит дружественное лицо.

Префиксы
--------

В своих стилях при переопределении имеющихся классов потребуется использовать префикс `.x-`. 
Для этого используйте SASS-переменную `$prefix`. Например:

```scss
.#{$prefix}animating-size {
    z-index: 10000;
}
```

Дополнительные замечания
------------------------

### Изображения компонента из ui === default

Различные компоненты имеют изображения, относящиеся к компоненту "default" ui(кнопки, меню и т. Д.). Когда вы создаете пользовательский uiдля одного из этих компонентов, вы заметите, когда тема скомпилирована, он предупреждает, что изображения для вашей темы не найдены.

```
WARNING: @theme-background-image: Theme image not found:
```

Обновляя тему или приложение, Sencha Cmd будет искать изображения, используя uiимя вместо "default"имени изображения. Например, если вы создаете mixin uiс именем "admin"для маленьких кнопок, Sencha Cmd предупредит, что "admin-small-arrow.png"не найден.

Решение этого предупреждения состоит в том, чтобы скопировать все объекты изображения с «по умолчанию» в имени файла из темы, которую вы распространяете в resources/imagesкаталог настраиваемой темы . Затем вы переименуете эти файлы и замените «default» на имя своего обычая ui. В случае "admin"кнопки uiв вашей настраиваемой теме, расширяющей Neptune, вы копируете "default"изображения из ext/classic/theme-neptune/resources/images/buttonпапки и вставляете их packages/local/my-theme/resources/images/button/. Затем вы переименуете все "default"экземпляры "admin". Например:

```bash
mv default-small-arrow.png admin-small-arrow.png
```

Остальные замечания читайте в разделе [Additional Notes][additional-notes].






Ссылки
-------

[Theming Ext JS][theming]  
[Theming The Ext JS Classic Toolkit][classic-theming]  
[Ext JS Modern Toolkit Theming Guidelines][modern-theming]  
[Глобальные переменные для тем][global-css]  
[Дополнительные замечания по созданию тем Classic Toolkit][additional-notes]  
[Шпаргалка по Sencha Cmd][cmd]  
[Быстрый старт с Sencha Cmd][quick-start] 

 


[cmd]: ../cmd
[quick-start]: ../quick-start.md

[theming]: http://docs.sencha.com/extjs/latest/guides/core_concepts/theming.html
[classic-theming]: http://docs.sencha.com/extjs/latest/guides/core_concepts/classic_theming.html
[modern-theming]: http://docs.sencha.com/extjs/latest/guides/core_concepts/modern_theming.html
[theme-chart]: http://docs.sencha.com/extjs/latest/guides/core_concepts/images/theme_chart.png

[global-css]: http://docs.sencha.com/extjs/latest/modern/Global_CSS.html
[panel]: http://docs.sencha.com/extjs/latest/classic/Ext.panel.Panel.html

[additional-notes]: http://docs.sencha.com/extjs/latest/guides/core_concepts/classic_theming.html#core_concepts-_-classic_theming_-_additional_notes

[fashion]: http://docs.sencha.com/cmd/6.5.3/guides/fashion.html