<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<title>Перечисление узлов</title>
<link rel="stylesheet" href="css/xsltbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.59.1">
<link rel="home" href="xsltbook.html" title="Технология XSLT">
<link rel="up" href="ch_11.html" title="Глава 11. Готовые решения">
<link rel="previous" href="ch_11.html" title="Глава 11. Готовые решения">
<link rel="next" href="ch_11_03.html" title="Именованный шаблон как функция">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="sect1" lang="ru">
<div class="titlepage"><div><h2 class="title" style="clear: both">
<a name="ch_11_02"></a>Перечисление узлов</h2></div></div>
<p>Функции <tt>name</tt> и <tt>local-name</tt> предоставляют возможности для работы с документом, 
          имена элементов и атрибутов в котором заранее неизвестны. Например, если шаблон определён как:</p>
<pre class="programlisting">&lt;xsl:template match=&quot;*[starts-with(local-name(), 'чеб')]&quot;&gt;
  ...
&lt;/xsl:template&gt;</pre>
<p>то обрабатываться им будут все элементы, локальные части имён которых 
				 начинаются на «чеб» (например, «чебуреки», «чебоксары», «чебурашка»).</p>
<p>Следующее преобразование демонстрирует, 
          как при помощи функции <tt>local-name</tt> и ключей 
          сосчитать количество элементов и атрибутов документа с различными именами.</p>
<div class="example">
<a name="LIST_11_04"></a><p class="title"><b>Пример 11.4. Входящий документ</b></p>
<pre class="programlisting">&lt;foo bar=&quot;1&quot;&gt;
  &lt;bar foo=&quot;2&quot;/&gt;
  &lt;bar bar=&quot;3&quot;/&gt;
  &lt;foo foo=&quot;4&quot;&gt;
    &lt;bar bar=&quot;5&quot;/&gt;
    &lt;bar foo=&quot;6&quot;/&gt;
  &lt;/foo&gt;
&lt;/foo&gt;</pre>
</div>
<div class="example">
<a name="LIST_11_05"></a><p class="title"><b>Пример 11.5. Преобразование</b></p>
<pre class="programlisting">&lt;xsl:stylesheet
  version=&quot;1.0&quot;
  xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&gt;

  &lt;!-- Выводим информацию в текстовом виде --&gt;
  &lt;xsl:output method=&quot;text&quot;/&gt;

  &lt;!--
   |   Создаём ключ, отображающий узлы атрибутов и элементов
   |   в их локальные части имён.
   +--&gt;
  &lt;xsl:key name=&quot;node&quot; match=&quot;*&quot; use=&quot;local-name()&quot;/&gt;
  &lt;xsl:key name=&quot;node&quot; match=&quot;@*&quot; use=&quot;local-name()&quot;/&gt;

  &lt;xsl:template match=&quot;*|@*&quot;&gt;
    &lt;xsl:variable name=&quot;name&quot; select=&quot;local-name()&quot;/&gt;
    &lt;!--
     |   Если узел является первым узлом группы (первым встретившимся
     |   узлом документа с данным именем), выводим информацию о
     |   количестве узлов в группе (количество узлов с таким же именем).
     +--&gt;
    &lt;xsl:if test=&quot;generate-id(.) = generate-id(key('node', $name))&quot;&gt;
      &lt;xsl:text&gt;Node '&lt;/xsl:text&gt;
      &lt;xsl:value-of select=&quot;local-name()&quot;/&gt;
      &lt;xsl:text&gt;' found &lt;/xsl:text&gt;
      &lt;xsl:value-of select=&quot;count(key('node', $name))&quot;/&gt;
      &lt;xsl:text&gt; times.&amp;#xA;&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;
    &lt;!-- Рекурсивно обрабатываем дочерний элемент и атрибуты --&gt;
    &lt;xsl:apply-templates select=&quot;*|@*&quot;/&gt;
  &lt;/xsl:template&gt;

&lt;/xsl:stylesheet&gt;</pre>
</div>
<div class="example">
<a name="LIST_11_06"></a><p class="title"><b>Пример 11.6. Выходящий документ</b></p>
<pre class="programlisting">Node 'foo' found 5 times.
Node 'bar' found 7 times.</pre>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch_11.html"><img src="images/db/prev.gif" alt="Пред."></a> </td>
<td width="20%" align="center"><a accesskey="u" href="ch_11.html"><img src="images/db/up.gif" alt="Уровень выше"></a></td>
<td width="40%" align="right"> <a accesskey="n" href="ch_11_03.html"><img src="images/db/next.gif" alt="След."></a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Глава 11. Готовые решения </td>
<td width="20%" align="center"><a accesskey="h" href="xsltbook.html"><img src="images/db/home.gif" alt="Начало"></a></td>
<td width="40%" align="right" valign="top"> Именованный шаблон как функция</td>
</tr>
</table>
</div>
</body>
</html>
